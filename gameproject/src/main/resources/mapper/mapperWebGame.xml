<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.mysql.mapperWebGame">
    
    <!-- ========================== Insert Mappers ============================== -->
    
    <!-- Members Insert -->
    <insert id="InsertMembers" parameterType="ModelMembers">        
        Insert into Members
        	('UserID', 'UserPW', 'UserNicName', 'UserEmail', 'UserLevel', 'SaveProduction')
        		values (#{UserID}, #{UserPW}, #{UserNicName}, #{UserEmail}, #{UserLevel}, #{SaveProduction})
    </insert>
    
    <!-- Castle Insert -->
    <insert id="InsertCastle" parameterType="ModelCastle">        
        Insert into Castle
        	('UserID', 'Name', 'Kind', 'LocationID','Production')
        		values (#{UserID}, #{Name}, #{Kind}, #{LocationID},#(Production))
    </insert>
    
    <!-- xyval Insert -->
    <insert id="InsertXYval" parameterType="ModelXYval">        
        Insert into xyval
        	('LocationID', 'CastleX', 'CastleY', 'Kind')
        		values (#{LocationID}, #{CastleX}, #{CastleY}, #{Kind})
    </insert>
    
    <!-- OutResource Insert -->
    <insert id="InsertOutResource" parameterType="ModelOutResource">        
        Insert into OutResource
        	('LocationID', 'UserID', 'Production', 'Kind')
        		values (#{LocationID}, #{UserID}, #{Production}, #{Kind})
    </insert>
    
    <!-- Building Insert -->
    <insert id="InsertBuilding" parameterType="ModelBuilding">        
        Insert into Building
        	('LocationID', 'Kind', 'Level', 'RoomNumber')
        		values (#{LocationID}, #{Kind}, #{Level}, #{RoomNumber})
    </insert>
    
    <!-- 성의 건설중인 건물리스트  목록 추가 -->
    <insert id="InsertWaitBuildingList" parameterType="ModelWaitList_Building">      
 			Insert into 
 				WaitList_Building
 					('WaitTime','LocationID','Kind','RoomNumber')
 						values (#(WaitTime),#(LocationID),#(Kind),#(RoomNumber))
    </insert>
    
    <!-- 성의 건설중인 유닛리스트  목록 추가 -->
    <insert id="InsertWaitUnitList" parameterType="ModelWaitList_Unit">      
 			Insert into 
 				WaitList_Unit
 					('WaitTime','LocationID','UnitID','Amount')
 						values (#(WaitTime),#(LocationID),#(UnitID),#(Amount))
    </insert>
    
    <!-- Castletroop Insert -->
    <insert id="InsertCastletroop" parameterType="ModelCastletroop">        
        Insert into Castletroop
        	('LocationID', 'SlotID')
        		values (#{LocationID}, #{SlotID})
    </insert>
    
    <!-- Herotable Insert -->
    <insert id="InsertHerotable" parameterType="ModelHeroTable">        
        Insert into Herotable
        	('HeroID', 'STR', 'AGI', 'CON', 'Owner', 'LocationID','Statuus', 'Specialty', 'Potrait', 'Sex')
        		values (#{HeroID}, #{STR}, #{AGI}, #{CON}, #{Owner}, #{LocationID}, #{Statuus}, #{Specialty}, #{Potrait}, #{Sex} )
    </insert>
    
    <!-- Herotroop Insert -->
    <insert id="InsertHerotroop" parameterType="ModelHerotroop">        
        Insert into Herotroop
        	('HeroID', 'SlotID')
        		values (#{HeroID}, #{SlotID})
    </insert>
    
    <!-- Slot Insert -->
    <insert id="InsertSlot" parameterType="ModelSlot">        
        Insert into Slot
        	('SlotID', 'SoltUID', 'SoltAmount')
        		values (#{SlotID}, #{SoltUID}, #{SoltAmount})
    </insert>
    
    <!-- ========================== Insert Mappers ============================== -->
    
    
    
    
    <!-- ========================== select Mappers ============================== -->
    
    <!-- 아이디와 비밀번호로 정보조회 -->
    <select id="getMembersLogin" parameterType="ModelMembers"  resultType="ModelMembers">        
        SELECT * FROM members
         WHERE UserID = #{UserID}
    </select>
    
    
    
    <!-- 유저 성 정보 가져오기 -->
    <select id="getCastle" parameterType="ModelMembers"  resultType="ModelCastle">        
        SELECT * FROM
         castle where UserID=#{UserID}
    </select>
    
    <!-- 성에 있는 영웅 정보 가져오기 -->
    <select id="getherotable" parameterType="ModelCastle"  resultType="ModelHeroTable">        
  		 SELECT * FROM
      		  herotable where LocationID=#{LocationID}
         		 
    </select>
    
    <!-- 성좌표 정보 가져오기 -->
    <select id="getXYval" parameterType="int"  resultType="ModelXYval">        
  		 SELECT * FROM
      		  xyval where LocationID=#{LocationID}
         		 
    </select>
    
    <!-- 성좌표 정보 가져오기 ver 2 -->
    <select id="getXYval2" parameterType="ModelXYval"  resultType="ModelXYval">        
  		 SELECT * FROM
      		  xyval where CastleX=#{CastleX} and CastleY=#{CastleY}
         		 
    </select>
    
    <!-- 모든 좌표 정보 가져오기 -->
    <select id="getXYvalAll">        
  		 SELECT * FROM
      		  xyval
      		  
    </select>
    
    <!-- 성에병력 슬롯ID 정보 가져오기 -->
    <select id="getCatleTroopData" parameterType="ModelCastle"  resultType="ModelSlot">        
 		select SlotID,SoltUID,SoltAmount from
			castletroop_SlotUnit
				where LocationID=#{LocationID}
 
    </select>
    
    <!-- 성의 건물 레벨 정보   가져오기 -->
    <select id="getBuildingLevel" parameterType="ModelCastle"  resultType="ModelBuilding">        
 		SELECT * FROM building where LocationID=#{LocationID}
      		  
    </select>
    
    <!-- 성자원지+야외자원지   가져오기 -->
    <select id="getAllProduction" parameterType="ModelCastle" resultType="int">      
 			select sum(ap.Production) from

			(select Production from castle  where castle.UserID = #{UserID}

				union

			 select Production from outresource  where outresource.UserID = #{UserID}) as ap
    </select>
    
    <!-- 성의 건설중인 건물리스트   가져오기 -->
    <select id="getWaitBuildingList" parameterType="ModelCastle" resultType="ModelWaitList_Building">      
 			select * from
 				WaitList_Building
 					where LocationID=#{LocationID}
    </select>
    
    <!-- 성의 건설중인 유닛리스트   가져오기 -->
    <select id="getWaitUnitList" parameterType="ModelCastle" resultType="ModelWaitList_Unit">      
 			select * from
 				WaitList_Unit
 					where LocationID=#{LocationID}
    </select>
    
    <!-- 영웅 정보 가져오기 -->
    <select id="getHero" parameterType="ModelHeroTable"  resultType="ModelHeroTable">        
 		select * from
			Herotable
				where HeroID=#{HeroID}
    </select>
    
    <!-- 영웅의병력 슬롯ID 정보 가져오기 -->
    <select id="getHeroTroopData" parameterType="ModelHeroTable"  resultType="ModelHeroTable">        
 		select SlotID,SoltUID,SoltAmount from
			herotroop_SlotUnit
				where HeroID=#{HeroID}
    </select>
    
    <!-- 유닛  스탯정보 가져오기 -->
    <select id="getUnit" parameterType="int" resultType="ModelUnit">        
 		SELECT * FROM unit
      		  	where UnitID=#{UnitID}
    </select>
    
    <!-- 유닛  건설정보 가져오기 -->
    <select id="getUnitBuild"  resultType="ModelUnitBuild">        
 		SELECT * FROM unitbuild
    </select>
    
    <!-- 건물 건설정보  가져오기 -->
    <select id="getStructures"  resultType="ModelStructures">        
 		SELECT * FROM structures
      		  
    </select>
    
    
    
    <!-- ========================== select Mappers ============================== -->
    
    
    <!-- ========================== update Mappers ============================== -->
    
    <!-- Member Update -->
    <update id="updateMembers" parameterType="ModelMembers">
    	update members 
       		SET  UserPW			=	#{UserPW}
       			,UserPW			=	#{UserPW}
       			,UserNicName	=	#{UserNicName}
       			,UserEmail		=	#{UserEmail}
       			,UserLevel		=	#{UserLevel}
       			,SaveProduction	=	#{SaveProduction}
       	WHERE 	 UserID			=	#{UserID}
    
    </update>
    
    <!-- User SaveProduction Update-->
    <update id="updateMembersProduction" parameterType="ModelMembers">
    	update castle 
       		SET  Production	=	#{Production}
       	WHERE 	 UserID		=	#{UserID}
    
    </update>
    
    <!-- ModelCastle Update -->
    <update id="updateCastle" parameterType="ModelCastle">
    	update
    		castle SET
    			 Name			=	#{Name}
    			,SaveProduction	=	#{SaveProduction}
    			,Kind			=	#{Kind}
       	WHERE	 LocationID		=	#{LocationID}
    
    </update>
    
    <!-- Catle Building Update -->
    <update id="updateBuilding" parameterType="ModelBuilding">
    	update Building 
       		SET  level		=	#{Level}
       			,RoomNumber	=	#{RoomNumber}
       	WHERE LocationID	=	#{LocationID}
    
    </update>
    

    
    <!-- 영웅 정보 업데이트 -->
    <update id="updateHero" parameterType="ModelHeroTable">
    	update updateHero 
       		SET	 STR		= #{STR}
				,AGI        = #{AGI}
				,CON        = #{CON}
				,Owner      = #{Owner}
				,LacationID = #{LacationID}
				,Statuus    = #{Statuus}
				,Specialty  = #{Specialty}
				,Potrait    = #{Potrait}
				,Sex        = #{Sex}
       	WHERE HeroID		= #{HeroID}
    
    </update>
    
    <!-- 영웅 슬롯 유닛 정보 업데이트 -->
    <update id="updateSlot" parameterType="ModelSlot">
    	update slot 
       		SET  SoltUID		=	#{SoltUID}
       			,SoltAmount		=	#{SoltAmount}
       	WHERE 	 SoltID			=	#{SoltID}
    
    </update>
    
    
    
    <!-- ========================== update Mappers ============================== -->
    
    
    
    
    <select id="getPhoneList"              resultType="ModelPhone">
        SELECT *  FROM TB_Phone 
    </select>
    
    <insert id="insertPhone" parameterType="ModelPhone">
        INSERT INTO 
        TB_phone (   name  ,   manufacturer   ,   price  )
        VALUES   ( #{name} , #{manufacturer}  , #{price} )
    </insert>
    
    <!-- mysql multi insert
        INSERT INTO t (col1, col2, col3) 
               VALUES ('val1_1', 'val1_2', 'val1_3')
                    , ('val2_1', 'val2_2', 'val2_3')
                    , ('val3_1', 'val3_2', 'val3_3')
        ;
     -->
    <insert id="insertPhoneList" parameterType="java.util.List">
        INSERT INTO  TB_Phone (   name  ,   manufacturer   ,   price  )
        VALUES
            <foreach collection="list" item="item" index="index" open="(" separator="),(" close=")">
                #{item.name} , #{item.manufacturer} , #{item.price}
            </foreach>
    </insert>
    
 </mapper>
